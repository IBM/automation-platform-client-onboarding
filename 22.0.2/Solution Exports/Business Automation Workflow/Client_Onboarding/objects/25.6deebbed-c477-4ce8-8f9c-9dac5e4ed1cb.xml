<?xml version="1.0" encoding="UTF-8"?>
<teamworks>
    <bpd id="25.6deebbed-c477-4ce8-8f9c-9dac5e4ed1cb" name="Review Documents_Validate Utility Bill">
        <lastModified>1664303687855</lastModified>
        <lastModifiedBy>cp4badmin</lastModifiedBy>
        <tenantId isNull="true" />
        <bpdId>25.6deebbed-c477-4ce8-8f9c-9dac5e4ed1cb</bpdId>
        <isTrackingEnabled>false</isTrackingEnabled>
        <isSpcEnabled>false</isSpcEnabled>
        <restrictedName isNull="true" />
        <isCriticalPathEnabled>false</isCriticalPathEnabled>
        <participantRef isNull="true" />
        <businessDataParticipantRef isNull="true" />
        <perfMetricParticipantRef isNull="true" />
        <ownerTeamParticipantRef isNull="true" />
        <timeScheduleType isNull="true" />
        <timeScheduleName isNull="true" />
        <timeScheduleExpression isNull="true" />
        <holidayScheduleType isNull="true" />
        <holidayScheduleName isNull="true" />
        <holidayScheduleExpression isNull="true" />
        <timezoneType isNull="true" />
        <timezone isNull="true" />
        <timezoneExpression isNull="true" />
        <internalName isNull="true" />
        <description></description>
        <type>2</type>
        <rootBpdId>25.06128cf3-4d4b-4ac0-bd33-a83c0eee9238</rootBpdId>
        <parentBpdId>25.06128cf3-4d4b-4ac0-bd33-a83c0eee9238</parentBpdId>
        <parentFlowObjectId>6deebbed-c477-4ce8-8f9c-9dac5e4ed1cb</parentFlowObjectId>
        <xmlData isNull="true" />
        <bpmn2Data isNull="true" />
        <dependencySummary isNull="true" />
        <jsonData isNull="true" />
        <migrationData isNull="true" />
        <rwfData isNull="true" />
        <rwfStatus isNull="true" />
        <templateId isNull="true" />
        <externalId isNull="true" />
        <guid>guid:207d6ea0639ca8b5:-43694325:17ee69075b7:-777b</guid>
        <versionId>2cdc4af9-5920-4ffc-a5d5-e6422bce76fc</versionId>
        <field1 isNull="true" />
        <field2 isNull="true" />
        <field3>0</field3>
        <field4 isNull="true" />
        <field5>false</field5>
        <clobField1 isNull="true" />
        <blobField1 isNull="true" />
        <BusinessProcessDiagram id="bpdid:89416636f7ce572e:-54eaee34:187e6df992f:-7e57">
            <metadata>
                <entry>
                    <key>SAP_META.SHOULDRECOVER</key>
                    <value>no</value>
                </entry>
            </metadata>
            <name>Review Documents_Validate Utility Bill</name>
            <documentation></documentation>
            <name>Review Documents_Validate Utility Bill</name>
            <dimension>
                <size w="0" h="0" />
            </dimension>
            <author>cpadmin</author>
            <isTrackingEnabled>false</isTrackingEnabled>
            <isCriticalPathEnabled>false</isCriticalPathEnabled>
            <isSpcEnabled>false</isSpcEnabled>
            <isDueDateEnabled>true</isDueDateEnabled>
            <isAtRiskCalcEnabled>true</isAtRiskCalcEnabled>
            <creationDate>1644612595209</creationDate>
            <modificationDate>1683651363915</modificationDate>
            <metricSettings itemType="2" />
            <instanceNameExpression>"Review Documents_Validate Utility Bill:" + tw.system.process.instanceId</instanceNameExpression>
            <dueDateType>1</dueDateType>
            <dueDateTime>1</dueDateTime>
            <dueDateTimeResolution>2</dueDateTimeResolution>
            <dueDateTimeTOD>00:00</dueDateTimeTOD>
            <officeIntegration>
                <sharePointParentSiteDisabled>true</sharePointParentSiteDisabled>
                <sharePointParentSiteName>&lt;#= tw.system.process.name #&gt;</sharePointParentSiteName>
                <sharePointParentSiteTemplate>ParentSiteTemplate.stp</sharePointParentSiteTemplate>
                <sharePointWorkspaceSiteName>&lt;#= tw.system.process.name #&gt; &lt;#= tw.system.process.instanceId #&gt;</sharePointWorkspaceSiteName>
                <sharePointWorkspaceSiteDescription>This site has been automatically generated for managing collaborations and documents 
for the Lombardi TeamWorks process instance: &lt;#= tw.system.process.name #&gt; &lt;#= tw.system.process.instanceId #&gt;

TeamWorks Link:  ~APPSERVER_URL~/portal/jsp/getProcessDetails.do?bpdInstanceId=&lt;#= tw.system.process.instanceId #&gt;

</sharePointWorkspaceSiteDescription>
                <sharePointWorkspaceSiteTemplate>WorkspaceSiteTemplate.stp</sharePointWorkspaceSiteTemplate>
                <sharePointLCID>1033</sharePointLCID>
            </officeIntegration>
            <timeScheduleType>0</timeScheduleType>
            <holidayScheduleType>0</holidayScheduleType>
            <timezoneType>0</timezoneType>
            <executionProfile>default</executionProfile>
            <isSBOSyncEnabled>false</isSBOSyncEnabled>
            <allowContentOperations>false</allowContentOperations>
            <isLegacyCaseMigrated>false</isLegacyCaseMigrated>
            <hasCaseObjectParams>false</hasCaseObjectParams>
            <defaultPool>
                <BpmnObjectId id="91403f16-8283-435f-8686-28aaddbe3433" />
            </defaultPool>
            <defaultInstanceUI id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7473" />
            <ownerTeamInstanceUI id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7474" />
            <simulationScenario id="bpdid:207d6ea0639ca8b5:-43694325:17ee69075b7:-7762">
                <name>Default</name>
                <simNumInstances>100</simNumInstances>
                <simMinutesBetween>30</simMinutesBetween>
                <maxInstances>100</maxInstances>
                <useMaxInstances>true</useMaxInstances>
                <continueFromReal>false</continueFromReal>
                <useParticipantCalendars>false</useParticipantCalendars>
                <useDuration>false</useDuration>
                <duration>86400</duration>
                <startTime>1644612595274</startTime>
            </simulationScenario>
            <flow id="d79595b2-0e1e-4a59-843a-069b51ea7997" connectionType="SequenceFlow">
                <name>To Subprocess End</name>
                <documentation></documentation>
                <nameVisible>false</nameVisible>
                <metricSettings itemType="32" />
                <connection>
                    <lineType>0</lineType>
                    <condition id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7387" />
                </connection>
            </flow>
            <flow id="4288ec65-058b-4991-8a2b-695aef41fc01" connectionType="SequenceFlow">
                <name>No</name>
                <documentation></documentation>
                <nameVisible>true</nameVisible>
                <metricSettings itemType="32" />
                <connection>
                    <lineType>0</lineType>
                    <condition id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7465">
                        <expression>tw.local.isValidDocument	  ==	  false</expression>
                    </condition>
                </connection>
            </flow>
            <flow id="a60d0896-8a1a-4a72-87e3-25779e242507" connectionType="SequenceFlow">
                <name>To Valid Address</name>
                <documentation></documentation>
                <nameVisible>false</nameVisible>
                <metricSettings itemType="32" />
                <connection>
                    <lineType>0</lineType>
                    <condition id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7386" />
                </connection>
            </flow>
            <flow id="f51b2f69-4bfa-4ab1-8e46-fd61cffa0514" connectionType="SequenceFlow">
                <name>To Validate Address</name>
                <documentation></documentation>
                <nameVisible>false</nameVisible>
                <metricSettings itemType="32" />
                <connection>
                    <lineType>0</lineType>
                    <condition id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7385" />
                </connection>
            </flow>
            <flow id="5faae334-3d93-4267-8e67-d5185926d115" connectionType="SequenceFlow">
                <name>To Subprocess End</name>
                <documentation></documentation>
                <nameVisible>false</nameVisible>
                <metricSettings itemType="32" />
                <connection>
                    <lineType>0</lineType>
                    <condition id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7384" />
                </connection>
            </flow>
            <flow id="65a5d79e-f2de-4984-83a5-5b4995020aa8" connectionType="SequenceFlow">
                <name>Yes</name>
                <documentation></documentation>
                <nameVisible>true</nameVisible>
                <metricSettings itemType="32" />
                <connection>
                    <lineType>0</lineType>
                    <condition id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7383" />
                </connection>
            </flow>
            <pool id="91403f16-8283-435f-8686-28aaddbe3433">
                <name>Pool</name>
                <documentation></documentation>
                <dimension>
                    <size w="3000" h="233" />
                </dimension>
                <autoTrackingEnabled>false</autoTrackingEnabled>
                <lane id="33ad69e4-42af-4b7d-8660-dbaebc4216b1">
                    <name>Team</name>
                    <height>233</height>
                    <laneColor>0</laneColor>
                    <systemLane>false</systemLane>
                    <attachedParticipant>5c817616-ef49-41fa-89ce-41f8666ef643/24.da7e4d23-78cb-4483-98ed-b9c238308a03</attachedParticipant>
                    <flowObject id="f14a75b1-46cb-4898-8832-f0f4155e0db9" componentType="Activity">
                        <name>Validate Address</name>
                        <documentation></documentation>
                        <position>
                            <location x="151" y="87" />
                        </position>
                        <dropIconUrl>0</dropIconUrl>
                        <colorInput>#A5B7CD</colorInput>
                        <component>
                            <loopType>0</loopType>
                            <loopMaximum>1</loopMaximum>
                            <startQuantity>1</startQuantity>
                            <isAutoflowable>false</isAutoflowable>
                            <MIOrdering>1</MIOrdering>
                            <MIFlowCondition>0</MIFlowCondition>
                            <cancelRemainingInstances>false</cancelRemainingInstances>
                            <metricSettings itemType="4" />
                            <implementationType>3</implementationType>
                            <isConditional>false</isConditional>
                            <bpmnTaskType>4</bpmnTaskType>
                            <activityOptionType>REQUIRED</activityOptionType>
                            <activityExecutionType>NONE</activityExecutionType>
                            <activityExecutionTypePreviousValue>AUTOMATIC</activityExecutionTypePreviousValue>
                            <isHidden>false</isHidden>
                            <isRepeatable>false</isRepeatable>
                            <transactionalBehavior>0</transactionalBehavior>
                            <isRobotTask>false</isRobotTask>
                            <implementation>
                                <script>var jsonOutput = JSON.parse(tw.local.jsonOutput);

// Service Address
var pageList = jsonOutput.result[0].data.pageList;

mainLoop:
	for (var i=0; i&lt;pageList.length; i++) {
		var kvpTable = pageList[i].KVPTable;
nestedLoop:
		for(var j=0; j&lt;kvpTable.length; j++) {
			if(kvpTable[j].KeyClass == "Service address") {
				tw.local.addressInDocument = kvpTable[j].Value;
				break mainLoop;
			}
		}
	}
	
tw.local.addressInSubmission = tw.local.caseProperties.AddressStreet.value + ", " + tw.local.caseProperties.AddressState.value + ", " + tw.local.caseProperties.AddressCity.value + " " + tw.local.caseProperties.AddressZipCode.value;
var addressInSubmissionTrimmed = tw.local.addressInSubmission.replace(/,| /g,"");
var addressInDocumentTrimmed = tw.local.addressInDocument.replace(/,| /g,"");
tw.local.isValidDocument = addressInSubmissionTrimmed == addressInDocumentTrimmed;</script>
                            </implementation>
                        </component>
                        <inputPort id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-746c">
                            <positionId>leftCenter</positionId>
                            <input>true</input>
                            <flow ref="f51b2f69-4bfa-4ab1-8e46-fd61cffa0514" />
                        </inputPort>
                        <outputPort id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-746b">
                            <positionId>rightCenter</positionId>
                            <flow ref="a60d0896-8a1a-4a72-87e3-25779e242507" />
                        </outputPort>
                    </flowObject>
                    <flowObject id="d36ae9dc-70aa-4de5-881f-1dd77536e69b" componentType="Activity">
                        <name>Handle Valid Address</name>
                        <documentation></documentation>
                        <position>
                            <location x="503" y="29" />
                        </position>
                        <dropIconUrl>0</dropIconUrl>
                        <colorInput>#A5B7CD</colorInput>
                        <component>
                            <loopType>0</loopType>
                            <loopMaximum>1</loopMaximum>
                            <startQuantity>1</startQuantity>
                            <isAutoflowable>false</isAutoflowable>
                            <MIOrdering>1</MIOrdering>
                            <MIFlowCondition>0</MIFlowCondition>
                            <cancelRemainingInstances>false</cancelRemainingInstances>
                            <metricSettings itemType="4" />
                            <implementationType>3</implementationType>
                            <isConditional>false</isConditional>
                            <bpmnTaskType>4</bpmnTaskType>
                            <activityOptionType>REQUIRED</activityOptionType>
                            <activityExecutionType>NONE</activityExecutionType>
                            <activityExecutionTypePreviousValue>AUTOMATIC</activityExecutionTypePreviousValue>
                            <isHidden>false</isHidden>
                            <isRepeatable>false</isRepeatable>
                            <transactionalBehavior>0</transactionalBehavior>
                            <isRobotTask>false</isRobotTask>
                            <implementation>
                                <script>// Prepare the document for upload
tw.local.ecmProperties = new tw.object.listOf.ECMProperty();
tw.local.ecmProperties[0] = new tw.object.ECMProperty();
tw.local.ecmProperties[0].objectTypeId = "CO_ServiceAddress";
tw.local.ecmProperties[0].value = tw.local.addressInDocument;
tw.local.ecmProperties[1] = new tw.object.ECMProperty();
tw.local.ecmProperties[1].objectTypeId = "CO_ClientName";
tw.local.ecmProperties[1].value = tw.local.caseProperties.ClientName.value;
tw.local.ecmProperties[2] = new tw.object.ECMProperty();
tw.local.ecmProperties[2].objectTypeId = "CO_ReferenceID";
tw.local.ecmProperties[2].value = tw.local.caseProperties.ReferenceID.value;

tw.local.documentClassFilenet = "CO_UtilityBill";
tw.local.fileName = "Utility Bill - " + tw.local.caseProperties.ClientName.value;

tw.system.currentProcessInstance.parentCase.addCommentToCase("A utility bill was provided by the client and has been verified automatically.");</script>
                            </implementation>
                        </component>
                        <inputPort id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7467">
                            <positionId>leftCenter</positionId>
                            <input>true</input>
                            <flow ref="65a5d79e-f2de-4984-83a5-5b4995020aa8" />
                        </inputPort>
                        <outputPort id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7464">
                            <positionId>rightCenter</positionId>
                            <flow ref="d79595b2-0e1e-4a59-843a-069b51ea7997" />
                        </outputPort>
                    </flowObject>
                    <flowObject id="a66485a6-0e30-45b9-89c6-d863c5ba3aa4" componentType="Activity">
                        <name>Handle Invalid Address</name>
                        <documentation></documentation>
                        <position>
                            <location x="502" y="146" />
                        </position>
                        <dropIconUrl>0</dropIconUrl>
                        <colorInput>#A5B7CD</colorInput>
                        <component>
                            <loopType>0</loopType>
                            <loopMaximum>1</loopMaximum>
                            <startQuantity>1</startQuantity>
                            <isAutoflowable>false</isAutoflowable>
                            <MIOrdering>1</MIOrdering>
                            <MIFlowCondition>0</MIFlowCondition>
                            <cancelRemainingInstances>false</cancelRemainingInstances>
                            <metricSettings itemType="4" />
                            <implementationType>3</implementationType>
                            <isConditional>false</isConditional>
                            <bpmnTaskType>4</bpmnTaskType>
                            <activityOptionType>REQUIRED</activityOptionType>
                            <activityExecutionType>NONE</activityExecutionType>
                            <activityExecutionTypePreviousValue>AUTOMATIC</activityExecutionTypePreviousValue>
                            <isHidden>false</isHidden>
                            <isRepeatable>false</isRepeatable>
                            <transactionalBehavior>0</transactionalBehavior>
                            <isRobotTask>false</isRobotTask>
                            <implementation>
                                <script>// Prepare the email body requesting the utility bill to be submitted again
tw.local.emailContent = tw.local.emailContent = "Hello " + tw.local.caseProperties.FirstName.value + ",&lt;br/&gt;&lt;br/&gt;This is with reference to your request with reference ID: " + tw.local.caseProperties.ReferenceID.value + "&lt;br/&gt;&lt;br/&gt;The address provided in the utility bill you provided does not match the address in your request.&lt;br/&gt;&lt;br/&gt;The address in your request is: " + tw.local.addressInSubmission + "&lt;br/&gt;The address in the utility bill is: " + tw.local.addressInDocument + "&lt;br/&gt;&lt;br/&gt;Please re-upload a utility bill with the right address &lt;a href=\"" + tw.env.documentUploadPage + "?ReferenceID=" + tw.local.caseProperties.ReferenceID.value + "\"&gt;on the following page&lt;/a&gt;.&lt;br/&gt;&lt;br/&gt;Regards,&lt;br/&gt;Focus Corp";

// Add a comment to the case
tw.system.currentProcessInstance.parentCase.addCommentToCase("The address in the utility bill provided does not match the address in the request. Waiting for the client to send another utility bill.");</script>
                            </implementation>
                        </component>
                        <inputPort id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7466">
                            <positionId>leftCenter</positionId>
                            <input>true</input>
                            <flow ref="4288ec65-058b-4991-8a2b-695aef41fc01" />
                        </inputPort>
                        <outputPort id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7462">
                            <positionId>rightCenter</positionId>
                            <flow ref="5faae334-3d93-4267-8e67-d5185926d115" />
                        </outputPort>
                    </flowObject>
                    <flowObject id="53f1e0fa-f387-4ccd-8719-c6c6253ae272" componentType="Event">
                        <name>Subprocess Start</name>
                        <documentation></documentation>
                        <position>
                            <location x="25" y="110" />
                        </position>
                        <dropIconUrl>0</dropIconUrl>
                        <colorInput>#A5B7CD</colorInput>
                        <component>
                            <nameVisible>true</nameVisible>
                            <eventType>1</eventType>
                            <cancelActivity>true</cancelActivity>
                            <repeatable>false</repeatable>
                            <doCloseTask>true</doCloseTask>
                        </component>
                        <outputPort id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-746d">
                            <positionId>rightCenter</positionId>
                            <flow ref="f51b2f69-4bfa-4ab1-8e46-fd61cffa0514" />
                        </outputPort>
                    </flowObject>
                    <flowObject id="a7f38b8b-e322-44c3-87ea-15c6e6061745" componentType="Event">
                        <name>Subprocess End</name>
                        <documentation></documentation>
                        <position>
                            <location x="670" y="110" />
                        </position>
                        <dropIconUrl>0</dropIconUrl>
                        <colorInput>#A5B7CD</colorInput>
                        <component>
                            <nameVisible>true</nameVisible>
                            <eventType>2</eventType>
                            <cancelActivity>true</cancelActivity>
                            <repeatable>false</repeatable>
                            <doCloseTask>true</doCloseTask>
                        </component>
                        <inputPort id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7463">
                            <positionId>leftCenter</positionId>
                            <input>true</input>
                            <flow ref="d79595b2-0e1e-4a59-843a-069b51ea7997" />
                        </inputPort>
                        <inputPort id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7461">
                            <positionId>leftCenter</positionId>
                            <input>true</input>
                            <flow ref="5faae334-3d93-4267-8e67-d5185926d115" />
                        </inputPort>
                    </flowObject>
                    <flowObject id="8935cb33-b9f3-45ff-8fe4-bb9e5503f426" componentType="Gateway">
                        <name>Valid Address</name>
                        <documentation></documentation>
                        <position>
                            <location x="305" y="106" />
                        </position>
                        <dropIconUrl>0</dropIconUrl>
                        <colorInput>#A5B7CD</colorInput>
                        <component>
                            <nameVisible>true</nameVisible>
                            <gatewayType>1</gatewayType>
                            <splitJoinType>0</splitJoinType>
                        </component>
                        <inputPort id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-746a">
                            <positionId>leftCenter</positionId>
                            <input>true</input>
                            <flow ref="a60d0896-8a1a-4a72-87e3-25779e242507" />
                        </inputPort>
                        <outputPort id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7468">
                            <positionId>rightCenter</positionId>
                            <flow ref="4288ec65-058b-4991-8a2b-695aef41fc01" />
                        </outputPort>
                        <outputPort id="bpdid:7cbdc5d8c70bf22a:-2dcdf158:183655bb412:-7469">
                            <positionId>rightCenter</positionId>
                            <flow ref="65a5d79e-f2de-4984-83a5-5b4995020aa8" />
                        </outputPort>
                    </flowObject>
                </lane>
                <privateVariable id="f1cc6652-b2f8-47a4-8054-69e658c608b4">
                    <name>addressInDocument</name>
                    <description></description>
                    <classId>5c817616-ef49-41fa-89ce-41f8666ef643/12.db884a3c-c533-44b7-bb2d-47bec8ad4022</classId>
                    <arrayOf>false</arrayOf>
                    <hasDefault>false</hasDefault>
                    <visibleInSearch>false</visibleInSearch>
                    <isProcessInstanceCorrelator>false</isProcessInstanceCorrelator>
                    <isSharedContext>false</isSharedContext>
                </privateVariable>
                <privateVariable id="6940c9a5-7f46-49c8-8e81-fd11b29702a6">
                    <name>addressInSubmission</name>
                    <description></description>
                    <classId>5c817616-ef49-41fa-89ce-41f8666ef643/12.db884a3c-c533-44b7-bb2d-47bec8ad4022</classId>
                    <arrayOf>false</arrayOf>
                    <hasDefault>false</hasDefault>
                    <visibleInSearch>false</visibleInSearch>
                    <isProcessInstanceCorrelator>false</isProcessInstanceCorrelator>
                    <isSharedContext>false</isSharedContext>
                </privateVariable>
            </pool>
        </BusinessProcessDiagram>
    </bpd>
</teamworks>

